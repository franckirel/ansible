---
# tasks file for reversibilite
- include_tasks: apache.yaml
  when: ansible_os_family == "RedHat"

- name: Add the OS specific varibles
  include_vars: "{{ ansible_os_family }}.yml"

- name: Remove lbn packages in Redhat derivatives
  yum: name='{{ item }}' state=absent
  with_items: '{{lbn_pkgs}}'
  when: ansible_os_family == 'RedHat'

- name: Remove lbn packages in Debian derivatives
  apt: name='{{ item }}' state=absent update_cache=yes
  with_items: '{{lbn_pkgs}}'
  when: ansible_os_family == 'Debian'

- name: Suppression des fichiers de script mysql
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /etc/lbn/mysql/script/mysqlInstance
    - /usr/local/linkbynet/script/bin/BackupMySQL.sh
    - /usr/local/linkbynet/script/bin/mysql-list
    - /usr/local/linkbynet/script/bin/mysqltuner.pl
    - /usr/local/linkbynet/script/bin/tuning-primer.sh
    - /usr/local/linkbynet/script/sbin/snapshot.pl
    - /usr/local/linkbynet/script/sbin/RestoreMySQL.pl
    - /etc/lbn/mysql/script/clustercheck
    - /etc/lbn/garbd/script/garbdInstance

- name: Suppression des fichiers de script memcached
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /etc/lbn/memcached/script/memcachedInstance
    - /etc/lbn/memcached/script/memcachedListInstances"

- name: Suppression des fichiers de script tomcat
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /etc/lbn/tomcat/script/tomcatInstance
    - /etc/lbn/tomcat/tpl

- name: Suppression des fichiers de script varnish
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /etc/lbn/varnish/script/varnishInstance

#- name: Delete files in  /home/lbn
#  shell: find /home/lbn/ -mindepth 2 -type f  ! -name '.bash*' ! -name authorized_keys ! -name known_hosts ! -name '.profile' -delete

#- name: Delete history
#  shell: find /home/lbn/ -mindepth 2 -type f -name .bash_history -delete

- name: Recursively find files in /home/lbn/
  find:
    paths: /home/lbn
    file_type: file
    hidden: yes
    excludes: '.bash_logout,.bash_profile,.bashrc,authorized_keys,known_hosts,.profile'
    recurse: yes
  register: files_to_delete

- name: Delete files in /home/lbn/
  file:
    path: "{{ item.path }}"
    state: absent
  with_items: "{{ files_to_delete.files }}"

- name: Suppression ds script du repos lbn-script-system
  file:
    path: "{{ item }}"
    state: absent
  with_items:
    - /usr/local/linkbynet/script/system/sbin/history-lbn
    - /usr/local/linkbynet/script/system/bin/check_antivirus.pl
    - /usr/local/linkbynet/script/system/bin/check_antivirus.pl
